(this["webpackJsonpfanfou-export"]=this["webpackJsonpfanfou-export"]||[]).push([[0],{30:function(e,t,a){e.exports=a(54)},53:function(e,t,a){},54:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(22),c=a.n(r),s=a(1),u=a.n(s),l=a(3),i=a(5),p=a(6),m=a(14),h=a(10),f=a(11),g=a(23),d=a.n(g),k=a(9),b=a.n(k),v=a(24),E=new(a(29).a)({consumerKey:"7008b986b162eb6ed2db8f50f26bc03e",consumerSecret:"0caea751b828756dca59a8ea7330384b",apiDomain:"cors.fanfou.pro",oauthDomain:"cors.fanfou.pro",hooks:{baseString:function(e){return e.replace("%2F%2Fcors.fanfou.pro%2Foauth","http%3A%2F%2Ffanfou.com%2Foauth").replace("%2F%2Fcors.fanfou.pro","http%3A%2F%2Fapi.fanfou.com")}}}),y=a(18),S=a.n(y),T=a(27),w=a.n(T),x=a(28),C=a.n(x),_=function(e,t){var a=new Blob([e],{type:"text/plain;charset=utf-8"});C.a.saveAs(a,t)},N=function(e){var t=e.map((function(e){var t="[".concat(e.user.screen_name,"]"),a="";if(e.txt.forEach((function(e){switch(e.type){case"at":a+="".concat(e.text,":").concat(e.id);break;case"link":a+=e.text;break;case"tag":default:a+=e._text}})),e.photo){var n="\u56fe:".concat(e.photo.originurl);a.length>0?a+=" ".concat(n):a+=n}var o=S()(new Date(e.created_at)).local().format("YYYY-MM-DD HH:mm:ss");return"".concat(t," ").concat(a," ").concat(o)})).join("\n");_(t,"backup.txt")},I=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CSV",a=e.map((function(e){var t=e.user.screen_name,a=e.photo?e.photo.originurl:"",n=S()(new Date(e.created_at)).local().format("YYYY-MM-DD HH:mm:ss"),o="";return e.txt.forEach((function(e){switch(e.type){case"at":o+="".concat(e.text,":").concat(e.id);break;case"link":o+=e.text;break;case"tag":default:o+=e._text}})),{ID:t,"\u6d88\u606f\u5185\u5bb9":o,"\u56fe\u7247":a,"\u65f6\u95f4":n}})),n=",";"TSV"===t&&(n="\t");var o=w.a.unparse(a,{delimiter:n,header:!0});_(o,"backup."+t.toLowerCase())},O=function(e){I(e,"TSV")},F=function(e){var t=e.map((function(e){return delete e.txt,delete e.user,e})),a=JSON.stringify(t,null,2);_(a,"backup.json")},D=function(e){var t="| \u996d\u5426\u6d88\u606f\u5907\u4efd |\n| :-- |\n"+e.map((function(e){var t=e.photo?e.photo.originurl:"",a=S()(new Date(e.created_at)).local().format("YYYY-MM-DD HH:mm:ss"),n="";return e.txt.forEach((function(e){switch(e.type){case"at":n+='<a href="https://fanfou.com/'.concat(e.id,'">').concat(e.text,"</a>");break;case"link":n+='<a href="'.concat(e.text,'">').concat(e.text,"</a>");break;case"tag":n+='<a href="https://fanfou.com/q/'.concat(e.query,'">').concat(e._text.replace(/\n/g," "),"</a>");break;default:n+=e._text.replace(/\n/g," ")}})),"| <div>".concat(n,"</div>").concat(t?'<div align="right"><a href="'.concat(t,'"><img width="100px" src="').concat(t,'"/></a></div>'):"",' <div align="right">').concat(a," \u901a\u8fc7 ").concat(e.source_url?'<a href="'.concat(e.source_url,'">').concat(e.source_name,"</a>"):e.source_name,"</div> |")})).join("\n");_(t,"backup.md")},M=(a(52),a(53),[]),A=[],j={USER_TIMELINE:"\u6d88\u606f",FAVORITES:"\u6536\u85cf"},V={TXT:"TXT",CSV:"CSV",TSV:"TSV",JSON:"JSON",Markdown:"Markdown"},Y=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(m.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={loged:!1,user:null,message:[],currentPage:0,pageCount:0,prevStatusCount:0,statusCount:0,done:!1,exportType:"TXT",dataType:"\u6d88\u606f"},a.goAuth=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.getRequestToken();case 2:t=e.sent,localStorage.setItem("requestTokenSecret",t.oauthTokenSecret),window.location.replace("https://fanfou.com/oauth/authorize?oauth_token=".concat(t.oauthToken,"&oauth_callback=").concat(window.location.href));case 5:case"end":return e.stop()}}),e)}))),a.getErroredPages=function(){return A},a.fetchStatuses=function(){var e=a.state,t=e.done,n=e.pageCount,o=e.dataType,r=j.USER_TIMELINE,c=j.FAVORITES;if(!t){var s=Array.from({length:n},(function(e,t){return t+1})),u="";switch(A.length>0&&(s=A,console.log("Retry pages",A)),o){case r:u="/statuses/user_timeline";break;case c:u="/favorites";break;default:return}v.a.eachLimit(s,6,(function(e,t){E.get(u,{page:e,count:60,format:"html"}).then((function(n){var o=M.length;n.forEach((function(e){M.push(e)})),A=a.getErroredPages().filter((function(t){return t!==e})),a.setState((function(e){return{currentPage:e.currentPage+1,prevStatusCount:o,statusCount:M.length}}),t)})).catch((function(a){console.error("Page ".concat(e," errored"),a),A.push(e),t()}))}),(function(e){e&&console.error(e),M.sort((function(e,t){return t.rawid-e.rawid})),a.setState({done:0===a.getErroredPages().length},(function(){a.fetchStatuses()}))}))}},a.startAnalyze=function(){var e=a.state,t=e.user,n=e.dataType,o=0;switch(n){case j.USER_TIMELINE:o=t.statuses_count;break;case j.FAVORITES:o=t.favourites_count;break;default:return}var r=Math.ceil(o/60);a.setState((function(e){return{message:e.message.concat(["\u4f60\u6709 ".concat(r," \u9875\u9884\u8ba1 ").concat(o," \u6761").concat(n,"\u5f85\u5bfc\u51fa\uff0c"),"\u5f00\u59cb\u83b7\u53d6".concat(n,"..")]),pageCount:r}}),a.fetchStatuses)},a.exportTypes=function(){var e=a.state.exportType;return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"\u9009\u62e9\u5bfc\u51fa\u683c\u5f0f\uff1a"),o.a.createElement("p",null,Object.values(V).map((function(t){return o.a.createElement("label",{key:t,style:{marginRight:5}},o.a.createElement("input",{checked:e===t,value:t,type:"radio",className:"nes-radio",name:"export-type",onChange:a.onChangeExportType}),o.a.createElement("span",null,t))}))))},a.onChangeExportType=function(e){var t=e.currentTarget.value;a.setState({exportType:t})},a.onChangeDataType=function(e){if(0===a.state.message.length){var t=e.currentTarget.value;a.setState({dataType:t})}},a.doExport=function(){switch(a.state.exportType){case V.TXT:N(M);break;case V.CSV:I(M);break;case V.TSV:O(M);break;case V.JSON:F(M);break;case V.Markdown:D(M)}},a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t,a,n,o,r,c,s,l,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window,!(a=t.location)||!a.search){e.next=16;break}if(this.setState({loged:!0}),n=b.a.parse(a.search),o=n.oauth_token,!(r=localStorage.getItem("requestTokenSecret"))){e.next=14;break}return e.next=9,E.getAccessToken({oauthToken:o,oauthTokenSecret:r});case 9:c=e.sent,localStorage.setItem("oauthToken",c.oauthToken),localStorage.setItem("oauthTokenSecret",c.oauthTokenSecret),localStorage.removeItem("requestTokenSecret"),window.location.replace(window.location.origin+window.location.pathname);case 14:e.next=26;break;case 16:if(s=localStorage.getItem("oauthToken"),l=localStorage.getItem("oauthTokenSecret"),!s||!l){e.next=26;break}return this.setState({loged:!0}),E.oauthToken=s,E.oauthTokenSecret=l,e.next=24,E.get("/users/show");case 24:i=e.sent,this.setState({user:i});case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.user,n=t.loged,r=t.dataType,c=t.message,s=t.currentPage,u=t.pageCount,l=t.prevStatusCount,i=t.statusCount,p=t.done;return o.a.createElement("div",null,o.a.createElement("div",{className:"nes-container with-title is-centered",style:{width:"90vw",maxWidth:800,margin:"40px auto 20px auto"}},o.a.createElement("p",{className:"title",style:{fontSize:24,margin:"-3rem auto 1rem"}},"\u996d\u5426\u6d88\u606f\u5907\u4efd\u5de5\u5177"),a?o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"\u4f60\u597d\uff0c",o.a.createElement("img",{className:"nes-avatar is-small",alt:"avatar",src:a.profile_image_url,style:{imageRendering:"pixelated"}})," ",a.name,"\u3002"),o.a.createElement("p",null,"\u9009\u62e9\u4f60\u8981\u5907\u4efd\u7684\u5185\u5bb9\uff1a"),o.a.createElement("p",null,Object.values(j).map((function(t){return o.a.createElement("label",{key:t,style:{marginRight:5}},o.a.createElement("input",{checked:r===t,value:t,type:"radio",className:"nes-radio",name:"data-type",onChange:e.onChangeDataType}),o.a.createElement("span",null,t))}))),c.length>0?o.a.createElement(o.a.Fragment,null,c.map((function(e,t){return o.a.createElement("p",{key:String(t)},e)})),o.a.createElement("p",null,o.a.createElement("progress",{className:"nes-progress is-pattern",value:s,max:u})),o.a.createElement("p",null,"\u5b9e\u9645\u5df2\u83b7\u53d6 ",o.a.createElement(d.a,{start:l,end:i,duration:p?1:3})," \u6761",r,"\u3002"),p&&o.a.createElement("p",null,"\u83b7\u53d6\u5b8c\u6bd5\u3002"),p&&this.exportTypes(),o.a.createElement("p",null,o.a.createElement("button",{disabled:!p,type:"button",className:"nes-btn ".concat(p?"is-success":"is-disabled"),onClick:this.doExport},"\u5bfc\u51fa")),o.a.createElement("button",{type:"button",className:"nes-btn",style:{position:"absolute",left:-4,bottom:-4},onClick:function(){window.location.reload()}},p?"\u8fd4\u56de":"\u505c\u6b62")):o.a.createElement("p",{className:"nes-pointer",onClick:this.startAnalyze},"> \u70b9\u51fb\u8fd9\u91cc\u5f00\u59cb\u5907\u4efd <"),o.a.createElement("button",{type:"button",className:"nes-btn is-error",style:{position:"absolute",right:-4,bottom:0},onClick:function(){localStorage.removeItem("oauthToken"),localStorage.removeItem("oauthTokenSecret"),window.location.reload()}},"\u9000\u51fa")):n?o.a.createElement("p",null,"\u6b63\u5728\u767b\u5f55.."):o.a.createElement("p",null,o.a.createElement("button",{type:"button",className:"nes-btn is-primary",onClick:this.goAuth},"\u767b\u5f55"))),o.a.createElement("p",{style:{textAlign:"center"}},o.a.createElement("span",{style:{fontWeight:700}},"<"),o.a.createElement("span",{style:{fontWeight:700,marginLeft:2}},">")," with ",o.a.createElement("a",{href:"https://fanfou.com/lito",target:"_blank",rel:"noopener noreferrer"},o.a.createElement("i",{className:"nes-icon is-small heart nes-pointer",style:{marginTop:-4,marginBottom:-4}}))," on ",o.a.createElement("a",{href:"https://github.com/LitoMore/fanfou-export",target:"_blank",rel:"noopener noreferrer"},o.a.createElement("i",{className:"nes-icon github is-small",style:{marginTop:-4,marginBottom:-4}}))))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/));function R(){return(R=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=5;break}return e.next=3,navigator.serviceWorker.ready;case 3:e.sent.unregister();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.a.render(o.a.createElement(Y,null),document.querySelector("#root")),function(){R.apply(this,arguments)}()}},[[30,1,2]]]);
//# sourceMappingURL=main.d8236824.chunk.js.map