(this["webpackJsonpfanfou-export"]=this["webpackJsonpfanfou-export"]||[]).push([[0],{35:function(e,t,a){e.exports=a(56)},55:function(e,t,a){},56:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),r=a(26),c=a.n(r),s=a(0),l=a.n(s),u=a(3),i=a(5),m=a(6),p=a(14),h=a(9),f=a(13),g=a(15),d=a.n(g),k=a(16),b=a.n(k),w=a(27),v=a.n(w),S=a(28),x=a.n(S),y=a(29),E=a.n(y),T=a(30),C=new(a(33).a)({consumerKey:"7008b986b162eb6ed2db8f50f26bc03e",consumerSecret:"0caea751b828756dca59a8ea7330384b",apiDomain:"cors.fanfou.pro",oauthDomain:"cors.fanfou.pro",hooks:{baseString:function(e){return e.replace("%2F%2Fcors.fanfou.pro%2Foauth","http%3A%2F%2Ffanfou.com%2Foauth").replace("%2F%2Fcors.fanfou.pro","http%3A%2F%2Fapi.fanfou.com")}}}),N=(a(54),a(55),[]),A={TXT:"TXT",CSV:"CSV",TSV:"TSV",JSON:"JSON"},_=function(e){function t(){var e,a;Object(i.a)(this,t);for(var n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return(a=Object(p.a)(this,(e=Object(h.a)(t)).call.apply(e,[this].concat(r)))).state={loged:!1,user:null,message:[],currentPage:0,pageCount:0,prevStatusCount:0,statusCount:0,done:!1,erroredPages:[],exportType:"TXT"},a.goAuth=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.getRequestToken();case 2:t=e.sent,localStorage.setItem("requestTokenSecret",t.oauthTokenSecret),window.location.replace("https://fanfou.com/oauth/authorize?oauth_token=".concat(t.oauthToken,"&oauth_callback=").concat(window.location.href));case 5:case"end":return e.stop()}}),e)}))),a.fetchStatuses=function(){var e=a.state,t=e.done,n=e.erroredPages,o=e.pageCount;if(!t){var r=Array.from({length:o},(function(e,t){return t+1}));n.length>0&&(console.log("Errored pages:",n),r=n),T.a.eachLimit(r,6,(function(e,t){C.get("/statuses/user_timeline",{page:e,count:60,format:"html"}).then((function(n){var o=N.length;n.forEach((function(e){N.push(e)})),a.setState((function(t){return{currentPage:t.currentPage+1,prevStatusCount:o,statusCount:N.length,erroredPages:t.erroredPages.filter((function(t){return t!==e}))}}),t)})).catch((function(n){console.error(n),a.setState((function(t){return{erroredPages:t.erroredPages.concat(e)}}),t)}))}),(function(e){e&&console.error(e),N.sort((function(e,t){return t.rawid-e.rawid})),a.setState({done:0===n.length},(function(){a.fetchStatuses()}))}))}},a.startAnalyze=function(){var e=a.state.user.statuses_count,t=Math.ceil(e/60);a.setState((function(a){return{message:a.message.concat(["\u4f60\u6709 ".concat(t," \u9875\u9884\u8ba1 ").concat(e," \u6761\u6d88\u606f\u5f85\u5bfc\u51fa\uff0c"),"\u5f00\u59cb\u83b7\u53d6\u6d88\u606f.."]),pageCount:t}}),a.fetchStatuses)},a.exportTypes=function(){var e=a.state.exportType;return o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"\u9009\u62e9\u5bfc\u51fa\u683c\u5f0f\uff1a"),o.a.createElement("p",null,Object.values(A).map((function(t){return o.a.createElement("label",{key:t,style:{marginRight:5}},o.a.createElement("input",{checked:e===t,value:t,type:"radio",className:"nes-radio",name:"export-type",onChange:a.onChangeExportType}),o.a.createElement("span",null,t))}))))},a.onChangeExportType=function(e){var t=e.currentTarget.value;a.setState({exportType:t})},a.downloadAsNofan=function(){var e=N.map((function(e){var t="[".concat(e.user.screen_name,"]"),a="";if(e.txt.forEach((function(e){switch(e.type){case"at":a+="".concat(e.text,":").concat(e.id);break;case"link":a+=e.text;break;case"tag":default:a+=e._text}})),e.photo){var n="\u56fe:".concat(e.photo.originurl);a.length>0?a+=" ".concat(n):a+=n}var o=b()(new Date(e.created_at)).local().format("YYYY-MM-DD HH:mm:ss");return"".concat(t," ").concat(a," ").concat(o)})).join("\n");d()(e,"backup.txt")},a.downloadAsCsv=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.CSV,t=N.map((function(e){var t=e.user.screen_name,a=e.photo?e.photo.originurl:"",n=b()(new Date(e.created_at)).local().format("YYYY-MM-DD HH:mm:ss"),o="";return e.txt.forEach((function(e){switch(e.type){case"at":o+="".concat(e.text,":").concat(e.id);break;case"link":o+=e.text;break;case"tag":default:o+=e._text}})),{ID:t,"\u6d88\u606f\u5185\u5bb9":o,"\u56fe\u7247":a,"\u65f6\u95f4":n}})),a=",";e===A.TSV&&(a="\t");var n=E.a.unparse(t,{delimiter:a,header:!0});d()(n,"backup."+e.toLowerCase())},a.downloadJson=function(){var e=N.map((function(e){return delete e.txt,delete e.user,e})),t=window.JSON.stringify(e,null,2);d()(t,"backup.json")},a.doExport=function(){var e=a.state.exportType,t=A.TSV;switch(e){case A.TXT:a.downloadAsNofan();break;case A.CSV:a.downloadAsCsv();break;case t:a.downloadAsCsv(t);break;case A.JSON:a.downloadJson()}},a}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=Object(u.a)(l.a.mark((function e(){var t,a,n,o,r,c,s,u,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window,!(a=t.location)||!a.search){e.next=16;break}if(this.setState({loged:!0}),n=x.a.parse(a.search),o=n.oauth_token,!(r=localStorage.getItem("requestTokenSecret"))){e.next=14;break}return e.next=9,C.getAccessToken({oauthToken:o,oauthTokenSecret:r});case 9:c=e.sent,localStorage.setItem("oauthToken",c.oauthToken),localStorage.setItem("oauthTokenSecret",c.oauthTokenSecret),localStorage.removeItem("requestTokenSecret"),window.location.replace(window.location.origin+window.location.pathname);case 14:e.next=26;break;case 16:if(s=localStorage.getItem("oauthToken"),u=localStorage.getItem("oauthTokenSecret"),!s||!u){e.next=26;break}return this.setState({loged:!0}),C.oauthToken=s,C.oauthTokenSecret=u,e.next=24,C.get("/users/show");case 24:i=e.sent,this.setState({user:i});case 26:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.user,a=e.loged,n=e.message,r=e.currentPage,c=e.pageCount,s=e.prevStatusCount,l=e.statusCount,u=e.done,i=e.erroredPages;return o.a.createElement("div",null,o.a.createElement("div",{className:"nes-container with-title is-centered",style:{width:"90vw",maxWidth:800,margin:"40px auto 20px auto"}},o.a.createElement("p",{className:"title",style:{fontSize:24,margin:"-3rem auto 1rem"}},"\u996d\u5426\u6d88\u606f\u5907\u4efd\u5de5\u5177"),t?o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,"\u4f60\u597d\uff0c",o.a.createElement("img",{className:"nes-avatar is-small",alt:"avatar",src:t.profile_image_url,style:{imageRendering:"pixelated"}})," ",t.name,"\u3002"),n.length>0?o.a.createElement(o.a.Fragment,null,n.map((function(e,t){return o.a.createElement("p",{key:String(t)},e)})),o.a.createElement("p",null,o.a.createElement("progress",{className:"nes-progress is-pattern",value:r,max:c})),o.a.createElement("p",null,"\u5b9e\u9645\u5df2\u83b7\u53d6 ",o.a.createElement(v.a,{start:s,end:l,duration:u?1:3})," \u6761\u6d88\u606f\u3002"),u&&0===i.length?o.a.createElement("p",null,"\u83b7\u53d6\u5b8c\u6bd5\u3002"):null,u?this.exportTypes():null,o.a.createElement("p",null,o.a.createElement("button",{disabled:!u,type:"button",className:"nes-btn ".concat(u?"is-success":"is-disabled"),onClick:this.doExport},"\u5bfc\u51fa"))):o.a.createElement("p",{className:"nes-pointer",onClick:this.startAnalyze},"> \u70b9\u51fb\u8fd9\u91cc\u5f00\u59cb\u5907\u4efd <"),o.a.createElement("button",{type:"button",className:"nes-btn is-error",style:{position:"absolute",right:-4,bottom:0},onClick:function(){localStorage.removeItem("oauthToken"),localStorage.removeItem("oauthTokenSecret"),window.location.reload()}},"\u9000\u51fa")):a?o.a.createElement("p",null,"\u6b63\u5728\u767b\u5f55.."):o.a.createElement("p",null,o.a.createElement("button",{type:"button",className:"nes-btn is-primary",onClick:this.goAuth},"\u767b\u5f55"))),o.a.createElement("p",{style:{textAlign:"center"}},o.a.createElement("span",{style:{fontWeight:700}},"<"),o.a.createElement("span",{style:{fontWeight:700,marginLeft:2}},">")," with ",o.a.createElement("a",{href:"https://fanfou.com/lito",target:"_blank",rel:"noopener noreferrer"},o.a.createElement("i",{className:"nes-icon is-small heart nes-pointer",style:{marginTop:-4,marginBottom:-4}}))," on ",o.a.createElement("a",{href:"https://github.com/LitoMore/fanfou-export",target:"_blank",rel:"noopener noreferrer"},o.a.createElement("i",{className:"nes-icon github is-small",style:{marginTop:-4,marginBottom:-4}}))))}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4]\d|[01]?\d\d?)){3}$/));function F(){return(F=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("serviceWorker"in navigator)){e.next=5;break}return e.next=3,navigator.serviceWorker.ready;case 3:e.sent.unregister();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.a.render(o.a.createElement(_,null),document.querySelector("#root")),function(){F.apply(this,arguments)}()}},[[35,1,2]]]);
//# sourceMappingURL=main.fa3c07a4.chunk.js.map