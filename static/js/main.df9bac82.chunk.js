(this["webpackJsonpfanfou-export"]=this["webpackJsonpfanfou-export"]||[]).push([[0],{276:function(t,e){},278:function(t,e){},317:function(t,e){},318:function(t,e){},444:function(t,e,n){},445:function(t,e,n){"use strict";n.r(e);var a=n(30),c=n.n(a),r=n(233),o=n.n(r),s=n(45),i=n(12),l=n.n(i),u=n(32),h=n(28),d=n(34),p=n(70),b=n(101),f=n(234),g=n.n(f),j=n(57),m=n.n(j),x=n(235),O=new(n(252).a)({consumerKey:"7008b986b162eb6ed2db8f50f26bc03e",consumerSecret:"0caea751b828756dca59a8ea7330384b",apiDomain:"api.fanfou.com",oauthDomain:"fanfou.com",protocol:"https:",hooks:{baseString:function(t){return t.replace("https","http")}}}),y=n(87),k=n.n(y),v=n(238),S=n.n(v),T=n(239),w=n.n(T),_=function(t,e){var n=new Blob([t],{type:"text/plain;charset=utf-8"});w.a.saveAs(n,e)},C=function(t){var e=t.map((function(t){var e,n="[".concat(t.user.screen_name,"]"),a="",c=Object(s.a)(t.txt);try{for(c.s();!(e=c.n()).done;){var r=e.value;switch(r.type){case"at":a+="".concat(r.text,":").concat(r.id);break;case"link":a+=r.text;break;case"tag":default:a+=r._text}}}catch(l){c.e(l)}finally{c.f()}if(t.photo){var o="\u56fe:".concat(t.photo.originurl);a+=a.length>0?" ".concat(o):o}var i=k()(new Date(t.created_at)).local().format("YYYY-MM-DD HH:mm:ss");return"".concat(n," ").concat(a," ").concat(i)})).join("\n");_(e,"backup.txt")},D=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"CSV",n=t.map((function(t){var e,n=t.user.screen_name,a=t.photo?t.photo.originurl:"",c=k()(new Date(t.created_at)).local().format("YYYY-MM-DD HH:mm:ss"),r="",o=Object(s.a)(t.txt);try{for(o.s();!(e=o.n()).done;){var i=e.value;switch(i.type){case"at":r+="".concat(i.text,":").concat(i.id);break;case"link":r+=i.text;break;case"tag":default:r+=i._text}}}catch(l){o.e(l)}finally{o.f()}return{ID:n,"\u6d88\u606f\u5185\u5bb9":r,"\u56fe\u7247":a,"\u65f6\u95f4":c}})),a=",";"TSV"===e&&(a="\t");var c=S.a.unparse(n,{delimiter:a,header:!0});_(c,"backup."+e.toLowerCase())},N=function(t){D(t,"TSV")},E=function(t){var e=t.map((function(t){return delete t.txt,delete t.user,t})),n=JSON.stringify(e,null,2);_(n,"backup.json")},I=function(t){var e="| \u996d\u5426\u6d88\u606f\u5907\u4efd |\n| :-- |\n"+t.map((function(t){var e,n=t.photo?t.photo.originurl:"",a=k()(new Date(t.created_at)).local().format("YYYY-MM-DD HH:mm:ss"),c="",r=Object(s.a)(t.txt);try{for(r.s();!(e=r.n()).done;){var o=e.value;switch(o.type){case"at":c+='<a href="https://fanfou.com/'.concat(o.id,'">').concat(o.text,"</a>");break;case"link":c+='<a href="'.concat(o.text,'">').concat(o.text,"</a>");break;case"tag":c+='<a href="https://fanfou.com/q/'.concat(o.query,'">').concat(o._text.replace(/\n/g," "),"</a>");break;default:c+=o._text.replace(/\n/g," ")}}}catch(i){r.e(i)}finally{r.f()}return"| <div>".concat(c,"</div>").concat(n?'<div align="right"><a href="'.concat(n,'"><img width="100px" src="').concat(n,'"/></a></div>'):"",' <div align="right">').concat(a," \u901a\u8fc7 ").concat(t.source_url?'<a href="'.concat(t.source_url,'">').concat(t.source_name,"</a>"):t.source_name,"</div> |")})).join("\n");_(e,"backup.md")},M=n(29),A=n(31),Y=n.p+"static/media/Zpix.99c5ce92.ttf",F=n(7);A.b.register({family:"Zpix",src:Y});var P=A.f.create({body:{paddingTop:35,paddingBottom:65,paddingHorizontal:35,fontFamily:"Zpix"},status:{margin:5,fontSize:12},text:{lineHeight:1.5},time:{fontSize:12,lineHeight:1.5,textAlign:"right"},link:{color:"#00ccff"},image:{width:100,marginLeft:"auto",marginRight:0,marginBottom:10},header:{fontSize:12,marginBottom:20,textAlign:"center",color:"grey"},pageNumber:{position:"absolute",fontSize:12,bottom:30,left:0,right:0,textAlign:"center",color:"grey"}}),R=function(t){var e=t.status;return e.txt.map((function(t,n){switch(t.type){case"at":return Object(F.jsx)(A.c,{style:Object(M.a)(Object(M.a)({},P.text),P.link),src:"https://fanfou.com/".concat(t.id),children:t.text},"at-".concat(e.id,"-").concat(String(n)));case"link":return Object(F.jsx)(A.c,{style:Object(M.a)(Object(M.a)({},P.text),P.link),src:t.text,children:t.text},"link-".concat(e.id,"-").concat(String(n)));case"tag":return Object(F.jsx)(A.c,{style:Object(M.a)(Object(M.a)({},P.text),P.link),src:"https://fanfou.com/q/".concat(t.query),children:t.text.split("")},"tag-".concat(e.id,"-").concat(String(n)));default:return Object(F.jsx)(A.g,{style:P.text,children:t.text.split("")},"text-".concat(e.id,"-").concat(String(n)))}}))},V=function(t){var e=t.fullList;return Object(F.jsx)(A.a,{children:Object(F.jsxs)(A.e,{style:P.body,children:[Object(F.jsx)(A.g,{style:P.header,children:"\u996d\u5426\u6d88\u606f\u5907\u4efd"}),e.map((function(t,e){return Object(F.jsxs)(c.a.Fragment,{children:[Object(F.jsx)(A.g,{style:P.status,children:Object(F.jsx)(R,{status:t})}),t.photo&&Object(F.jsx)(A.c,{style:Object(M.a)(Object(M.a)({},P.time),P.link),src:t.photo.originurl,children:"[\u56fe]"}),Object(F.jsxs)(A.g,{style:P.time,children:["\u901a\u8fc7"," ",t.source_url?Object(F.jsx)(A.c,{style:P.link,src:t.source_url,children:t.source_name}):Object(F.jsx)(A.g,{style:P.link,children:t.source_name})]}),Object(F.jsx)(A.g,{style:P.time,children:k()(new Date(t.created_at)).local().format("YYYY-MM-DD HH:mm:ss")})]},"status-".concat(t.id,"-").concat(String(e)))}))]})})},H=function(t){var e=t.document,n=t.done;return Object(F.jsx)(A.d,{document:e,fileName:"backup.pdf",children:function(t){t._blob,t._url;var e=t.loading;t._error;return n&&!e?Object(F.jsx)("button",{className:"nes-btn is-success",type:"button",children:"\u5bfc\u51fa"}):Object(F.jsx)("button",{disabled:!0,className:"nes-btn is-disabled",type:"button",children:"\u6b63\u5728\u751f\u6210 PDF"})}})},L=(n(443),n(444),[]),q=[],z={USER_TIMELINE:"\u6d88\u606f",FAVORITES:"\u6536\u85cf"},B={TXT:"TXT",CSV:"CSV",TSV:"TSV",JSON:"JSON",Markdown:"Markdown",PDF:"PDF"},J=function(t){Object(p.a)(n,t);var e=Object(b.a)(n);function n(){var t;Object(h.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(t=e.call.apply(e,[this].concat(c))).state={loged:!1,user:null,message:[],currentPage:0,pageCount:0,prevStatusCount:0,statusCount:0,done:!1,exportType:"TXT",dataType:"\u6d88\u606f"},t.goAuth=Object(u.a)(l.a.mark((function t(){var e;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.getRequestToken();case 2:e=t.sent,localStorage.setItem("requestTokenSecret",e.oauthTokenSecret),window.location.replace("https://fanfou.com/oauth/authorize?oauth_token=".concat(e.oauthToken,"&oauth_callback=").concat(window.location.href));case 5:case"end":return t.stop()}}),t)}))),t.getErroredPages=function(){return q},t.fetchStatuses=function(){var e=t.state,n=e.done,a=e.pageCount,c=e.dataType,r=z.USER_TIMELINE,o=z.FAVORITES;if(!n){var i=Array.from({length:a},(function(t,e){return e+1})),l="";switch(q.length>0&&(i=q,console.log("Retry pages",q)),c){case r:l="/statuses/user_timeline";break;case o:l="/favorites";break;default:return}x.a.eachLimit(i,6,(function(e,n){O.get(l,{page:e,count:60,format:"html"}).then((function(a){var c,r=L.length,o=Object(s.a)(a);try{for(o.s();!(c=o.n()).done;){var i=c.value;L.push(i)}}catch(l){o.e(l)}finally{o.f()}q=t.getErroredPages().filter((function(t){return t!==e})),t.setState((function(t){return{currentPage:t.currentPage+1,prevStatusCount:r,statusCount:L.length}}),n)})).catch((function(t){console.error("Page ".concat(e," errored"),t),q.push(e),n()}))}),(function(e){e&&console.error(e),L.sort((function(t,e){return e.rawid-t.rawid})),t.setState({done:0===t.getErroredPages().length},(function(){t.fetchStatuses()}))}))}},t.startAnalyze=function(){var e=t.state,n=e.user,a=e.dataType,c=0;switch(a){case z.USER_TIMELINE:c=n.statuses_count;break;case z.FAVORITES:c=n.favourites_count;break;default:return}var r=Math.ceil(c/60);t.setState((function(t){return{message:t.message.concat(["\u4f60\u6709 ".concat(r," \u9875\u9884\u8ba1 ").concat(c," \u6761").concat(a,"\u5f85\u5bfc\u51fa\uff0c"),"\u5f00\u59cb\u83b7\u53d6".concat(a,"..")]),pageCount:r}}),t.fetchStatuses)},t.exportTypes=function(){var e=t.state.exportType;return Object(F.jsxs)(F.Fragment,{children:[Object(F.jsx)("p",{children:"\u9009\u62e9\u5bfc\u51fa\u683c\u5f0f\uff1a"}),Object(F.jsx)("p",{children:Object.values(B).map((function(n){return Object(F.jsxs)("label",{style:{marginRight:5},children:[Object(F.jsx)("input",{checked:e===n,value:n,type:"radio",className:"nes-radio",name:"export-type",onChange:t.onChangeExportType}),Object(F.jsx)("span",{children:n})]},n)}))})]})},t.onChangeExportType=function(e){var n=e.currentTarget.value;t.setState({exportType:n})},t.onChangeDataType=function(e){if(0===t.state.message.length){var n=e.currentTarget.value;t.setState({dataType:n})}},t.doExport=function(){switch(t.state.exportType){case B.TXT:C(L);break;case B.CSV:D(L);break;case B.TSV:N(L);break;case B.JSON:E(L);break;case B.Markdown:I(L)}},t}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var t=Object(u.a)(l.a.mark((function t(){var e,n,a,c,r,o,s,i,u;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window,!(n=e.location)||!n.search){t.next=16;break}if(this.setState({loged:!0}),a=m.a.parse(n.search),c=a.oauth_token,!(r=localStorage.getItem("requestTokenSecret"))){t.next=14;break}return t.next=9,O.getAccessToken({oauthToken:c,oauthTokenSecret:r});case 9:o=t.sent,localStorage.setItem("oauthToken",o.oauthToken),localStorage.setItem("oauthTokenSecret",o.oauthTokenSecret),localStorage.removeItem("requestTokenSecret"),window.location.replace(window.location.origin+window.location.pathname);case 14:t.next=26;break;case 16:if(s=localStorage.getItem("oauthToken"),i=localStorage.getItem("oauthTokenSecret"),!s||!i){t.next=26;break}return this.setState({loged:!0}),O.oauthToken=s,O.oauthTokenSecret=i,t.next=24,O.get("/users/show");case 24:u=t.sent,this.setState({user:u});case 26:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e=this.state,n=e.user,a=e.loged,c=e.dataType,r=e.message,o=e.currentPage,s=e.pageCount,i=e.prevStatusCount,l=e.statusCount,u=e.done,h=e.exportType,d=B.PDF;return Object(F.jsxs)("div",{children:[Object(F.jsxs)("div",{className:"nes-container with-title is-centered",style:{width:"90vw",maxWidth:800,margin:"40px auto 20px auto"},children:[Object(F.jsx)("p",{className:"title",style:{fontSize:24,margin:"-3rem auto 1rem"},children:"\u996d\u5426\u6d88\u606f\u5907\u4efd\u5de5\u5177"}),n?Object(F.jsxs)(F.Fragment,{children:[Object(F.jsxs)("p",{children:["\u4f60\u597d\uff0c",Object(F.jsx)("img",{className:"nes-avatar is-small",alt:"avatar",src:n.profile_image_url,style:{imageRendering:"pixelated"}})," ",n.name,"\u3002"]}),Object(F.jsx)("p",{children:"\u9009\u62e9\u4f60\u8981\u5907\u4efd\u7684\u5185\u5bb9\uff1a"}),Object(F.jsx)("p",{children:Object.values(z).map((function(e){return Object(F.jsxs)("label",{style:{marginRight:5},children:[Object(F.jsx)("input",{checked:c===e,value:e,type:"radio",className:"nes-radio",name:"data-type",onChange:t.onChangeDataType}),Object(F.jsx)("span",{children:e})]},e)}))}),r.length>0?Object(F.jsxs)(F.Fragment,{children:[r.map((function(t,e){return Object(F.jsx)("p",{children:t},String(e))})),Object(F.jsx)("p",{children:Object(F.jsx)("progress",{className:"nes-progress is-pattern",value:o,max:s})}),Object(F.jsxs)("p",{children:["\u5b9e\u9645\u5df2\u83b7\u53d6"," ",Object(F.jsx)(g.a,{start:i,end:l,duration:u?1:3})," ","\u6761",c,"\u3002"]}),u&&Object(F.jsx)("p",{children:"\u83b7\u53d6\u5b8c\u6bd5\u3002"}),u&&this.exportTypes(),u&&L.length>1e3&&Object(F.jsx)("p",{style:{color:"grey"},children:"\u6d88\u606f\u6570\u91cf\u8d85\u8fc7 1000 \u6761\uff0cPDF \u7c7b\u578b\u5728\u7ebf\u5bfc\u51fa\u8f83\u6162\u3002\u5efa\u8bae\u9009\u62e9 MARKDOWN \u5bfc\u51fa\u540e\u81ea\u884c\u4f7f\u7528\u5176\u4ed6\u5de5\u5177\u8f6c\u6362\u4e3a PDF\u3002"}),Object(F.jsx)("p",{children:h===d?Object(F.jsx)(H,{done:u,document:Object(F.jsx)(V,{fullList:L})}):Object(F.jsx)("button",{className:"nes-btn ".concat(u?"is-success":"is-disabled"),disabled:!u,type:"button",onClick:this.doExport,children:"\u5bfc\u51fa"})}),Object(F.jsx)("button",{type:"button",className:"nes-btn",style:{position:"absolute",left:-4,bottom:-4},onClick:function(){window.location.reload()},children:u?"\u8fd4\u56de":"\u505c\u6b62"})]}):Object(F.jsx)("p",{className:"nes-pointer",onClick:this.startAnalyze,children:"> \u70b9\u51fb\u8fd9\u91cc\u5f00\u59cb\u5907\u4efd <"}),Object(F.jsx)("button",{type:"button",className:"nes-btn is-error",style:{position:"absolute",right:-4,bottom:0},onClick:function(){localStorage.removeItem("oauthToken"),localStorage.removeItem("oauthTokenSecret"),window.location.reload()},children:"\u9000\u51fa"})]}):a?Object(F.jsx)("p",{children:"\u6b63\u5728\u767b\u5f55.."}):Object(F.jsx)("p",{children:Object(F.jsx)("button",{type:"button",className:"nes-btn is-primary",onClick:this.goAuth,children:"\u767b\u5f55"})})]}),Object(F.jsxs)("p",{style:{textAlign:"center"},children:[Object(F.jsx)("span",{style:{fontWeight:700},children:"<"}),Object(F.jsx)("span",{style:{fontWeight:700,marginLeft:2},children:">"})," with ",Object(F.jsx)("a",{href:"https://fanfou.com/lito",target:"_blank",rel:"noopener noreferrer",children:Object(F.jsx)("i",{className:"nes-icon is-small heart nes-pointer",style:{marginTop:-4,marginBottom:-4}})})," on ",Object(F.jsx)("a",{href:"https://github.com/LitoMore/fanfou-export",target:"_blank",rel:"noopener noreferrer",children:Object(F.jsx)("i",{className:"nes-icon github is-small",style:{marginTop:-4,marginBottom:-4}})})]})]})}}]),n}(c.a.Component);o.a.render(Object(F.jsx)(J,{}),document.querySelector("#root"))}},[[445,1,2]]]);
//# sourceMappingURL=main.df9bac82.chunk.js.map